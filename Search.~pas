unit Search;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, ComCtrls, ExtCtrls, Buttons, StdCtrls, PHPEdit;

type
  TSearchForm = class(TForm)
    MainPanel: TPanel;
    PageControl: TPageControl;
    FindSheet: TTabSheet;
    ReplaceSheet: TTabSheet;
    FindEdit: TEdit;
    FindFromCursorBox: TCheckBox;
    CaseSensitiveFindBox: TCheckBox;
    FindForwardRadio: TRadioButton;
    FindBackwardRadio: TRadioButton;
    FindBtn: TSpeedButton;
    CalcBtn: TSpeedButton;
    CloseFindBtn: TSpeedButton;
    FindStatusBar: TStatusBar;
    FindReplEdit: TEdit;
    ReplaceEdit: TEdit;
    FindReplLabel: TLabel;
    ReplaceLabel: TLabel;
    FindLabel: TLabel;
    ReplaceFromCursorBox: TCheckBox;
    CaseSensitiveReplaceBox: TCheckBox;
    ReplaceForwardRadio: TRadioButton;
    ReplaceBackwardRadio: TRadioButton;
    ReplaceStatusBar: TStatusBar;
    ReplaceBtn: TSpeedButton;
    ReplaceAllBtn: TSpeedButton;
    CloseReplaceBtn: TSpeedButton;
    procedure PageControlChange(Sender: TObject);
    procedure FormShow(Sender: TObject);
    procedure FindBtnClick(Sender: TObject);
    procedure CalcBtnClick(Sender: TObject);
    procedure ReplaceBtnClick(Sender: TObject);
    procedure ReplaceAllBtnClick(Sender: TObject);
    procedure FindEditChange(Sender: TObject);
    procedure FindReplEditChange(Sender: TObject);
    procedure FindFromCursorBoxClick(Sender: TObject);
    procedure ReplaceFromCursorBoxClick(Sender: TObject);
    procedure CaseSensitiveFindBoxClick(Sender: TObject);
    procedure CaseSensitiveReplaceBoxClick(Sender: TObject);
    procedure ReplaceForwardRadioClick(Sender: TObject);
    procedure FindForwardRadioClick(Sender: TObject);
    procedure FindBackwardRadioClick(Sender: TObject);
    procedure ReplaceBackwardRadioClick(Sender: TObject);
    procedure CloseFindBtnClick(Sender: TObject);
    procedure CloseReplaceBtnClick(Sender: TObject);
  private
    { Private declarations }
  public
    PHPEditor: TPHPEdit;
  end;

var
  SearchForm: TSearchForm;

implementation

uses Main;

{$R *.dfm}

procedure TSearchForm.FormShow(Sender: TObject);
begin
  FindEdit.Clear;
  FindReplEdit.Clear;
  ReplaceEdit.Clear;
  FindStatusBar.Panels[0].Text := '';
  ReplaceStatusBar.Panels[0].Text := '';

  if Caption = 'Find' then
    PageControl.Pages[0].Show
  else if Caption = 'Replace' then
    PageControl.Pages[1].Show
end;

procedure TSearchForm.PageControlChange(Sender: TObject);
begin
  Caption := PageControl.ActivePage.Caption;
end;

procedure TSearchForm.FindBtnClick(Sender: TObject);
begin
  FindStatusBar.Panels[0].Text := '';
  if not PHPEditor.Find(FindEdit.Text,
                        FindFromCursorBox.Checked,
                        CaseSensitiveFindBox.Checked,
                        FindForwardRadio.Checked) then begin
    if FindEdit.Text <> '' then
      FindStatusBar.Panels[0].Text := 'Can not find the text"'+FindEdit.Text+'"';
  end;
end;

procedure TSearchForm.CalcBtnClick(Sender: TObject);
var
  MatcCount: Integer;
begin
  FindStatusBar.Panels[0].Text := '';
  MatcCount := PHPEditor.CalcFind(FindEdit.Text,
                                  FindFromCursorBox.Checked,
                                  CaseSensitiveFindBox.Checked,
                                  FindForwardRadio.Checked);
  if FindEdit.Text <> '' then
    FindStatusBar.Panels[0].Text := IntToStr(MatcCount) + ' matches';
end;

procedure TSearchForm.ReplaceBtnClick(Sender: TObject);
var
  RepCount: Integer;
begin
  ReplaceStatusBar.Panels[0].Text := '';
  RepCount := PHPEditor.Replace(FindReplEdit.Text,
                                ReplaceEdit.Text,
                                ReplaceForwardRadio.Checked,
                                ReplaceFromCursorBox.Checked,
                                CaseSensitiveReplaceBox.Checked);

  ReplaceStatusBar.Panels[0].Text := '';
end;

procedure TSearchForm.ReplaceAllBtnClick(Sender: TObject);
var
  RepCount: Integer;
begin
  ReplaceStatusBar.Panels[0].Text := '';
  RepCount := PHPEditor.ReplaceAll(FindReplEdit.Text,
                                   ReplaceEdit.Text,
                                   ReplaceForwardRadio.Checked,
                                   ReplaceFromCursorBox.Checked,
                                   CaseSensitiveReplaceBox.Checked);

  ReplaceStatusBar.Panels[0].Text := IntToStr(RepCount) + ' occurrences were replaced';
end;

procedure TSearchForm.FindEditChange(Sender: TObject);
begin
  FindReplEdit.Text := FindEdit.Text;
end;

procedure TSearchForm.FindReplEditChange(Sender: TObject);
begin
  FindEdit.Text := FindReplEdit.Text;
end;

procedure TSearchForm.FindFromCursorBoxClick(Sender: TObject);
begin
  ReplaceFromCursorBox.Checked := FindFromCursorBox.Checked;
end;

procedure TSearchForm.ReplaceFromCursorBoxClick(Sender: TObject);
begin
  FindFromCursorBox.Checked := ReplaceFromCursorBox.Checked;
end;

procedure TSearchForm.CaseSensitiveFindBoxClick(Sender: TObject);
begin
  CaseSensitiveReplaceBox.Checked := CaseSensitiveFindBox.Checked;
end;

procedure TSearchForm.CaseSensitiveReplaceBoxClick(Sender: TObject);
begin
  CaseSensitiveFindBox.Checked := CaseSensitiveReplaceBox.Checked;
end;

procedure TSearchForm.FindForwardRadioClick(Sender: TObject);
begin
  ReplaceForwardRadio.Checked := FindForwardRadio.Checked;
end;

procedure TSearchForm.ReplaceForwardRadioClick(Sender: TObject);
begin
  FindForwardRadio.Checked := ReplaceForwardRadio.Checked;
end;

procedure TSearchForm.FindBackwardRadioClick(Sender: TObject);
begin
  ReplaceBackwardRadio.Checked := FindBackwardRadio.Checked;
end;

procedure TSearchForm.ReplaceBackwardRadioClick(Sender: TObject);
begin
  FindBackwardRadio.Checked := ReplaceBackwardRadio.Checked;
end;

procedure TSearchForm.CloseFindBtnClick(Sender: TObject);
begin
  ModalResult := mrCancel;
end;

procedure TSearchForm.CloseReplaceBtnClick(Sender: TObject);
begin
  ModalResult := mrCancel;
end;

end.
